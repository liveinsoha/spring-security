# 카카오 :

1. 웹서버 주소 : http://localhost:8080
2. 카카오 REST API 키 d4767dbfadeb0bc96b02d1e7c6f06b09
3. 카카오 로그인 요청 callback 주소 : http://localhost:8080/auth/kakao/callback

카카오로부터 받을 정보 : profile정보(필수)

장점 : 인증 처리 수고 덜 수 있다.
단점 : 네이버의 정보만으로 서비스를 처리할 수 없을 때 네이버 정보와 서비스의 정보 연동이 필요하다.

oAuth 인증 처리를 대신 해준다.


프로세스

블로그에 로그인 요청을 하고 아래에 카카오 로그인 버튼을 누르면 다시 사용자는 카카오에 로그인 요청을 하게 된다.
카카오는 동의 화면을 사용자에게 준다. (로그인 안 되어 있는 경우 카카오 로그인 요청) -> 동의 요청.
카카오 서버는 카카오 회원이 정상이라는 걸 판단한 후 블로그 서버에 callBack하고 코드를 건넨다
-> 여기까지가 인증 처리 완료.
블로그 서버는 카카오 서버로 부터 밭은 코드를 가지고 카카오 자원 서버에 접근할 수 있는 권한 요청을 한다.
카카오 서버는 블로그 서버가 정상이라고 판단하면 액세스 토큰(열쇠)을 부여한다.
->
블로그 서버는 액세스 토큰을 가지고  카카오 자원 서버의 홍길동의 정보에 접근할 수 있다.
카카오가 블로그 서버에 홍길동의 정보에 접근할 수 있는 권한을 위임했다.

1.인증 처리 완료. 홍길동을 인증한다.
2. 정보 접근 권한 부여. 홍길동의 정보에 접근할 수 있는 키를 준다

홍길동(리소스 오너)  블로그 서버(클라이언트)  카카오 API서버(인증 서버)  자원 서버(리소스 서버)
이 과정을 직접 구현해본다.

스프링 공식 oAtuh-client-라이브러리에서는 구글 로그인과 페이스북 로그인을 쉽게하도록 지원한다.
네이버나 카카오를 통하여 oAuth 사용하는 방법은 따로 존재한다.

카카오 로그인 구현
로그인 요청 주소(GET)
https://kauth.kakao.com/oauth/authorize?response_type=code&client_id=$d4767dbfadeb0bc96b02d1e7c6f06b09&redirect_uri=$http://localhost:8080/auth/kakao/callback
(카카오 개발자 페이지에서 다음 주소를 가져와 카카오 버튼에 심는다)

7. 응답받은 코드
   로그인에 성공하면 http://localhost:8080/auth/kakao/callback?code=zHIbgYyJ6ufdJKtCFw3kayBKY3rLTETEs6jtKOX-KoC661E-F8oIfHIhT0wKPXObAAABjSoZKFVtZc76WqiBKA
   이 주소로 이동하고 code를 들고 온다. 정상적으로 인증이 진행 되었다는 뜻이다. -> 이 주소에 대한 컨트롤러를 만들어야 한다.

인가코드만으로는 카카오 로그인이 완료되지 않지만 인증된 사용자로 파악하고 글쓰기 권한을 줄 수 있지만, 사용자의 정보를 아무것도 모른다
사용자의 정보에 접근하기 위해 사용자 토큰을 받아야 한다.

8. 토큰 발급 요청 주소(POST) - (Post방식은 쿼리스트링을 전달하는 것이 아니라 http 바디에 5가지 데이터를 전달한다)
   요청 주소 : https://kauth.kakao.com/oauth/token
   헤더 값
   (Content-type: application/x-www-form-urlencoded;charset=utf-8 요청 데이터 타입 key=value 형태이다)
   바디 값
   grant_type=authorization_code
   client_id= d4767dbfadeb0bc96b02d1e7c6f06b09
   redirect_uri= http://localhost:8080/auth/kakao/callback
   code={동적임}

응답 :
엑세스 토큰은 만료시간을 가지고 있다. 항상 요청을해서 개인 정보를 가지고 올 수 없으니
토큰이 만료가 돠면 refresh_token이 없다면 다시 로그인을 해야하지만
refresh_token의 역할은 액세스 토큰을 다시 발급받을 수 있게 하는 역할이다 (중요x)

응답으로 액세스 토큰을 받았다. 이 토큰을 가지고 사용자의 개인정보에 접근할 수 있다.

사용자 정보 요청 응답에서 중요한 건 회원번호, kakaoAccount

9. 액세스 토큰을 가지고 사용자 요청 정보를 가져오자.(POST)
   요청 주소 : https://kapi.kakao.com/v2/user/me
   헤더 값 :
   Authorization: Bearer ${ACCESS_TOKEN}
   Content-type: application/x-www-form-urlencoded;charset=utf-8

% 주의 사항
카카오로 로그인한 사용자가 회원정보 수정을 할 수 없게 막아야 한다.
회원 정보를 수정하여 비밀번호를 바꿀 경우 카카오 로그인이 실패한다.

또한, 일반 로그인 창에서 악의적인 사용자가 카카오 계정과 cos1234를 가지고 카카오 회원의 로그인을 진행할 수 있다.